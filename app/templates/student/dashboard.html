{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
    <h1 class="mb-4">Добро пожаловать, {{ current_user.full_name or current_user.username }}!</h1>
    <hr>

    <div class="row g-4">
        {# Блок с доступными тестами #}
        <div class="col-lg-8">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h4 class="my-0"><i class="bi bi-card-checklist me-2"></i>Доступные тесты</h4>
                </div>
                <div class="card-body">
                    {% if available_tests %}
                        <div class="list-group list-group-flush"> {# flush убирает границы внутри карточки #}
                        {% for test in available_tests %}
                             <a href="{{ url_for('student.take_test', test_id=test.id) }}"
                               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <span>
                                    <i class="bi bi-pencil-square me-2"></i> {{ test.title }}
                                    {% if test.lesson %}<small class="text-muted ms-2">({{ test.lesson.title }})</small>{% endif %}
                                </span>
                                <span class="badge bg-primary rounded-pill">Пройти <i class="bi bi-arrow-right-short"></i></span>
                            </a>
                        {% endfor %}
                        </div>
                    {% else %}
                         <div class="alert alert-success mb-0"> {# mb-0 убирает нижний отступ #}
                            <i class="bi bi-check-circle-fill me-2"></i>Поздравляем! У вас нет новых тестов для прохождения.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        {# Блок с быстрыми ссылками и недавними оценками #}
        <div class="col-lg-4">
             {# Быстрый доступ #}
             <div class="card shadow-sm mb-4">
                 <div class="card-header">
                      <h5 class="my-0"><i class="bi bi-collection-play-fill me-2"></i>Быстрый доступ</h5>
                 </div>
                 <div class="card-body text-center">
                     <a href="{{ url_for('main.list_lessons') }}" class="btn btn-outline-primary mb-2 w-100"><i class="bi bi-book me-1"></i> Перейти к урокам</a>
                     <a href="{{ url_for('student.my_results') }}" class="btn btn-outline-secondary w-100"><i class="bi bi-award me-1"></i> Мои результаты</a>
                 </div>
            </div>

            {# Недавние оценки компетенций #}
             <div class="card shadow-sm">
                 <div class="card-header">
                      <h5 class="my-0"><i class="bi bi-person-check-fill me-2"></i>Оценки компетенций</h5>
                 </div>
                 <div class="card-body p-0"> {# p-0 убирает padding у card-body #}
                     {% if recent_assessments %}
                        <ul class="list-group list-group-flush">
                             {% for assessment in recent_assessments %}
                                <li class="list-group-item small"> {# small делает текст мельче #}
                                    <div class="d-flex w-100 justify-content-between">
                                      <strong class="mb-1">{{ assessment.competency_name }}</strong>
                                      <small class="text-muted">{{ assessment.assessment_date.strftime('%d.%m.%y') }}</small>
                                    </div>
                                    {% set level_lower = assessment.level|lower if assessment.level else '' %}
                                    {% if 'превосходный' in level_lower or 'высокий' in level_lower %} {% set level_color = 'success' %}
                                    {% elif 'средний' in level_lower %} {% set level_color = 'primary' %}
                                    {% elif 'базовый' in level_lower %} {% set level_color = 'info' %}
                                    {% else %} {% set level_color = 'secondary' %}
                                    {% endif %}
                                    <span class="badge bg-{{ level_color }}">{{ assessment.level if assessment.level else '-' }}</span>
                                </li>
                             {% endfor %}
                        </ul>
                     {% else %}
                        <p class="text-muted p-3 mb-0"><small>У вас пока нет оценок компетенций.</small></p>
                     {% endif %}
                 </div>
                 {% if recent_assessments %}
                 <div class="card-footer text-center">
                     <a href="{{ url_for('student.my_results') }}#competencies" class="btn btn-sm btn-outline-secondary">Все оценки <i class="bi bi-arrow-right"></i></a>
                 </div>
                 {% endif %}
            </div>
        </div>
    </div>

{% endblock %}